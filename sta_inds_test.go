package banta

import (
	"math"
	"testing"
)

func TestCommon(t *testing.T) {
	sumArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 274199.19999999995, 274022.49999999994, 274018.19999999995, 273238.1, 273923.69999999995, 273728.6, 274130.6, 274019.5, 273876.3, 273574.1, 273072.69999999995, 272255.29999999993, 271777.79999999993, 270119.5999999999, 269897.0999999999, 268784.49999999994, 267783.99999999994, 266993.89999999997, 266357.99999999994, 265762.39999999997, 265310.49999999994, 264690.19999999995, 264127.49999999994, 263757.89999999997, 263764.19999999995, 263728.1, 263493.19999999995, 263341.19999999995, 263117.19999999995, 262980.79999999993, 263468.69999999995, 263820.69999999995, 263563.19999999995, 263808.6, 264049.1, 264241.3, 264603.1, 264716, 264227.7, 261078.40000000002, 257547.7, 254192.30000000002, 250952.7, 247647.40000000002, 244398.50000000003, 241398.20000000004, 238374.00000000003, 235711.30000000002, 235105.90000000002, 235151.50000000003}
	smaArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 30466.577777777773, 30446.944444444438, 30446.46666666666, 30359.788888888885, 30435.96666666666, 30414.288888888885, 30458.955555555553, 30446.61111111111, 30430.699999999997, 30397.12222222222, 30341.411111111105, 30250.58888888888, 30197.533333333326, 30013.28888888888, 29988.56666666666, 29864.944444444438, 29753.77777777777, 29665.988888888885, 29595.33333333333, 29529.155555555553, 29478.944444444438, 29410.02222222222, 29347.499999999993, 29306.43333333333, 29307.133333333328, 29303.12222222222, 29277.02222222222, 29260.133333333328, 29235.24444444444, 29220.08888888888, 29274.299999999996, 29313.411111111105, 29284.799999999996, 29312.066666666666, 29338.788888888885, 29360.144444444442, 29400.344444444443, 29412.88888888889, 29358.633333333335, 29008.711111111115, 28616.411111111112, 28243.58888888889, 27883.633333333335, 27516.37777777778, 27155.38888888889, 26822.022222222226, 26486.000000000004, 26190.144444444446, 26122.87777777778, 26127.94444444445}
	vwmaArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 30524.599643405712, 30514.947778072055, 30518.73472309875, 30456.35125607252, 30561.6906998281, 30571.491940019365, 30596.344888113847, 30625.932222795036, 30578.763946722098, 30520.68031661973, 30475.612235503984, 30396.577778674644, 30344.774942173266, 30089.91299329545, 29964.10592800004, 29848.88716224751, 29774.985707611893, 29690.46221220152, 29634.867703120217, 29567.390982826124, 29492.60358258962, 29428.407632842318, 29387.756345074333, 29312.21865963103, 29316.914650750692, 29312.63520407313, 29281.90217571912, 29273.797795962546, 29259.965305452115, 29230.72511109319, 29315.838091154554, 29369.12733541649, 29387.74815897663, 29390.76956763887, 29416.513237722298, 29455.91685299767, 29462.82320005344, 29461.46986192912, 29443.68254303843, 28445.962714246307, 27837.615204021622, 27557.626796029796, 27356.826089102113, 27209.127081137973, 27007.291985516127, 26698.107930434846, 26503.991087758564, 26258.531212277307, 26111.93120533944, 26099.481219512756}
	emaArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 30464.45, 30614.796153846157, 30565.335207100594, 30520.883636777427, 30474.10153881167, 30420.562840532948, 30332.107018912495, 30264.93670831057, 30192.023368570484, 30145.77361955964, 30090.039216550467, 30087.079337081163, 29945.036362145598, 29832.92307566166, 29756.473371713713, 29672.354391450062, 29615.05371584236, 29572.59929802046, 29526.214790632697, 29479.227899766127, 29513.377453648263, 29460.565537702376, 29417.432378055855, 29368.765858354956, 29320.909572454195, 29283.215792076626, 29270.82874714176, 29345.932016812258, 29380.83478345653, 29390.506355232446, 29394.35153135053, 29398.405141911986, 29382.235120079375, 29387.968178528703, 29357.32692029352, 29258.41508640221, 28850.920457724944, 28418.79423345957, 28060.256659081173, 27770.355634607145, 27515.747075436815, 27289.385986908077, 27155.51121969145, 27003.063339738917, 26856.699749009855, 26725.561326085262, 26627.428814379837}
	ema2Arr := []float64{30573.6, 30579.615384615383, 30667.213017751477, 30680.887938097403, 30651.27440915934, 30531.755269288675, 30500.392920167338, 30464.840163218516, 30416.06475349259, 30413.116329878343, 30443.15997143552, 30431.735360445444, 30587.11453576153, 30541.912299490526, 30501.06425341506, 30457.331291351205, 30406.372631143327, 30320.09991865974, 30254.776854250547, 30183.42656898123, 30138.49940452258, 30083.884111519103, 30081.871171285395, 29940.629452626104, 29829.194152222088, 29753.318128803305, 29669.68457052587, 29612.794636598814, 29570.687769429765, 29524.597343363646, 29477.85929053847, 29512.219399686397, 29459.585645888492, 29416.603238828724, 29368.06427900892, 29320.315928392163, 29282.713477870293, 29270.403712044095, 29345.572371729617, 29380.5304683866, 29390.248857865587, 29394.13364896319, 29398.22077989193, 29382.07912144702, 29387.83617968594, 29357.215228965026, 29258.320578355022, 28850.840489377326, 28418.72656793466, 28060.19940363702, 27770.307187692862, 27515.70608189396, 27289.351300064118, 27155.481869285024, 27003.038504779634, 26856.678734813537, 26725.543544842225, 26627.413768712653}
	rmaArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 30464.45, 30545.8875, 30524.838541666664, 30504.135329861107, 30480.190719039347, 30450.6831591194, 30400.259562526116, 30358.19626564894, 30310.929910178194, 30275.969084330012, 30234.929993969177, 30221.252494471744, 30133.131453265763, 30056.728832160283, 29996.668096146925, 29931.08742146801, 29878.48846967901, 29833.53943053909, 29786.669477994168, 29739.513688161318, 29736.32088081454, 29689.135807413328, 29646.724490128883, 29601.255782618144, 29555.959467399964, 29515.954511783297, 29489.849969134688, 29512.279138373466, 29517.322543509006, 29511.18733154992, 29503.213387254094, 29496.337271649583, 29479.417499012117, 29474.42437409444, 29450.6223429199, 29389.27048100991, 29157.639607592413, 28898.01130695971, 28663.868698046397, 28456.537973209197, 28261.44314210843, 28076.68954693273, 27938.565418021666, 27790.734966519856, 27645.815385976533, 27509.022437145155, 27390.57890071639}
	ram2Arr := []float64{30573.6, 30576.858333333334, 30624.536805555555, 30635.500405092593, 30623.242038001543, 30560.838534834747, 30541.426990265183, 30518.749741076415, 30487.83726265338, 30480.25915743226, 30490.93756097957, 30480.76776423127, 30560.84545054533, 30538.54999633322, 30516.70416330545, 30491.71214969666, 30461.24447055527, 30409.940764675666, 30367.070700952696, 30319.064809206637, 30283.426075106083, 30241.76556884724, 30227.518438109968, 30138.875234934134, 30061.993965356287, 30001.49446824326, 29935.511595889657, 29882.54396289885, 29837.25696599061, 29790.07721882473, 29742.637450589333, 29739.184329706884, 29691.760635564642, 29649.130582600923, 29603.461367384178, 29557.981253435493, 29517.807815649205, 29491.548831011773, 29513.836428427458, 29518.750059391838, 29512.49588777585, 29504.412897127862, 29497.436822367206, 29480.42542050327, 29475.348302127997, 29451.469276950666, 29390.046837204776, 29158.35126743771, 28898.663661817896, 28664.46668999974, 28457.08613249976, 28261.94562145811, 28077.15015300327, 27938.987640252995, 27791.122003565244, 27646.170169934805, 27509.34765577357, 27390.877017792438}
	atrArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 868.7357142857145, 834.6545918367348, 825.014978134111, 825.1924796959602, 797.214445431963, 808.2134136153943, 775.5053126428661, 747.5263617398043, 740.510193044104, 777.7380363980966, 746.9353195125183, 735.5470824044812, 718.2151479470183, 697.1212088079457, 658.7839796073782, 642.9065524925655, 627.3989416002395, 667.2275886287938, 701.9684751553086, 686.442155501358, 676.2534301084038, 641.163899386375, 611.1164780016339, 609.7653010015173, 646.0392080728374, 656.1578360676348, 639.7251334913751, 618.6804810991339, 582.3461610206243, 555.4928638048656, 559.8648021045182, 551.453030525624, 551.5135283452224, 811.7554191777066, 840.7728892364419, 815.431968576696, 781.2225422497893, 759.7066463748044, 766.0276002051755, 783.168485904806, 779.6064511973198, 762.8917046832254, 719.856582920138, 684.0096841401281}
	macdArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), -432.8189359786011, -444.3755230798597, -441.170279092752, -430.50440099353364, -422.66641215803975, -415.7213620771472, -367.2200110214326, -367.40248513993356, -362.5528282796149, -360.93155491862854, -359.010254650977, -351.9618256133472, -332.31349146006687, -268.75524115240114, -230.74971465889394, -208.64225413368695, -191.19347732181632, -174.9291253772244, -170.35586815137867, -154.76421798125375, -159.18826166014333, -198.68415614747937, -395.26032241365465, -590.0472296317275, -732.248399336695, -828.3268268908796, -898.9885370613556, -949.7692098494881, -948.8324810100021, -957.5956423920543, -962.55486407438, -959.2522045482874, -939.0800102808571}
	rsiArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 47.259212807554704, 46.70629211781631, 45.8275752808261, 43.125379869273104, 43.760684849102844, 42.68535167846982, 44.10644555140259, 42.876051193200524, 47.10701411799357, 37.63104526409479, 38.403425773341404, 40.22115784448889, 38.91619668986348, 40.40333995062702, 41.07475694985178, 40.228100031133394, 39.578221058849, 48.1873373099479, 41.19850655078743, 41.372647790121036, 40.36443558254441, 39.79147258385859, 40.17498273779458, 42.90370502456327, 53.026566637768326, 49.84133970135824, 47.70183518334326, 47.224962254061744, 47.32952422046857, 44.978274547034694, 47.7474393187741, 43.4430835586769, 36.21354076590418, 20.173578633140377, 17.874268771834664, 18.686651486974352, 20.29657492693332, 20.002028758934504, 19.641782747405784, 27.105353979353485, 25.380843118505094, 24.632435113606412, 24.30835157555169, 26.14944480511085}
	kdjKArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 41.59251412429377, 40.38547551789079, 43.31489328311366, 41.03937800795151, 54.42102927104603, 45.70157711771732, 39.62900840105888, 32.16576641959718, 28.892793228680386, 25.324447186467175, 23.624461389617572, 21.06936881756818, 20.731960164093092, 19.5281520141573, 34.485741895766935, 29.8946064528907, 28.028270130019365, 29.293479877035974, 27.489154299575365, 28.177255906215894, 29.81721277464621, 29.436933511013187, 28.09339536542298, 43.619202886368996, 42.76911691199349, 42.42536575288385, 40.44994580227355, 38.17487832167819, 37.05995928114531, 39.11598230284624, 49.78320388817201, 53.243704552898976, 51.68512497186102, 50.04646740166552, 49.06459439331127, 45.701160779228196, 46.14220822589189, 41.530964613013, 27.88796997891727, 30.7354485393475, 29.949461031618032, 29.8069429838719, 30.283840778313756, 30.206789256691753, 29.69188735568628, 32.27109038606571, 32.801945525247, 33.55437654991516, 38.06746039608561, 43.021382509579155}
	smaKdjKArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 37.30755649717518, 41.21115819209047, 55.61546935614055, 48.64511735530738, 45.64362519201231, 24.32860874515855, 22.35666675708752, 19.25796146852044, 20.253030581601966, 18.123809523809502, 18.74693877551022, 17.712287414966003, 33.859533410138276, 34.077930980136706, 36.469618236800365, 25.610610807494698, 26.66666666666667, 28.419287211740095, 28.843696258552644, 30.442320204916978, 29.05994018983218, 42.91783732875024, 47.048693988582016, 52.49254210872268, 39.76863809965331, 37.28723756540164, 34.98465682053997, 37.227630968938364, 49.72526553505039, 58.170127095808176, 59.950106250320516, 51.833941317804175, 47.47932214922079, 44.28143139631311, 44.3664816822947, 39.43569135251218, 26.64492040573343, 23.11362125272966, 21.80329079569762, 31.4432661882489, 29.712343090578738, 30.270743156341624, 29.984135378106856, 32.04808873798256, 33.31841193470317, 35.45079694989522, 38.67217416376253, 45.02736447474808}
	stdDevArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), 233.17264505082903, 415.2175689924494, 425.6949640294085, 288.8038046840789, 205.30537840007997, 183.63963188810848, 152.87635003492284, 152.56708163952098, 448.86692281788834, 423.05229747632865, 438.33616597310333, 463.68621027587204, 488.933224888635, 163.82381511856025, 172.09438573062218, 166.26428359692866, 114.51091476361499, 47.61726577618697, 103.73112551206582, 306.2189543447632, 367.30637130330354, 353.7246918155418, 340.5338596968, 63.17931940120955, 56.61165957645099, 47.7983095935407, 48.39232997077091, 171.7789439948918, 188.83169861016526, 199.45858116411088, 216.7098650269532, 233.95417158067556, 49.54262810953771, 57.592860668662794, 264.65260550389434, 282.08038145181183, 246.59005170525373, 183.7488133295012, 131.5172171238425, 88.94937886236193, 53.54047440955347, 93.04789304438916, 261.2497088993589, 1045.2869397442978, 1393.1812157791967, 1348.408633315584, 1014.3225057150221, 206.3027716730926, 49.69665582310407, 132.3311089653525, 126.45558904216117, 137.3191843844113, 150.90302316388502, 146.52864566357005}
	bbandArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 31263.256691056144, 31242.777598521177, 31205.486141764297, 30833.007099192728, 30746.516593224074, 30708.154765111783, 31313.230805589723, 31313.081261981184, 31312.934634961857, 31306.657573165143, 31312.401629807322, 31299.272592140278, 31288.23568020823, 30460.311890696124, 30368.071890628315, 30248.355757754664, 30162.4121803554, 30308.895132806025, 30341.24180079079, 30276.6632678924, 30225.46395668496, 30083.96589084472, 29957.000106174273, 29387.41393998648, 29374.516566659328, 29649.546059392003, 29647.938730385828, 29649.709879675615, 29652.501521230002, 29639.554673341812, 29627.052547454638, 29624.523165934126, 29672.070835934217, 29787.92317915481, 29829.875710057087, 29845.90192776787, 29829.774424394553, 29780.41417653337, 29751.421272738306, 29618.36568217993, 29756.185385462722, 30765.85969034254, 31042.03379466916, 30833.067811824923, 30357.57170262833, 29508.270881203483, 28353.049846552334, 26616.398633132758, 26390.402529209216, 26389.394375410448, 26396.594795225377, 26384.240986614222}
	tdArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), -1, -2, -3, -4, -5, 1, 2, 3, 4, -1, -2, -3, -4, -5, -6, -7, -8, -9, 1, -1, -2, -3, -4, 1, 2, -1, 1, 2, -1, -2, -3, -4, -5, 1, 2, 3, 4, 5, -1, -2, -3, -4, -5, -6, -7, -8, -9, -10, 1, 2, -1, -2, -3, -4}
	adxArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), 38.71201944784718, 33.99157648502356, 29.902079811261828, 25.350341473460148, 19.67771860657121, 15.44608070007865, 13.525881016608766, 12.70656730514597, 12.60560365024865, 13.709937433943585, 14.814271217638517, 15.287658712271558, 17.012400137997094, 17.50189161468327, 21.231388616099473, 20.271078530554632, 19.310768445009792, 20.873956214173468, 22.360180639269238, 23.34749843407242, 25.88700006889198, 25.185634463953267, 25.175487517756746, 22.324309890376924, 21.27483035954913, 20.22535082872134, 17.523185831432343, 16.323526324945902, 15.445939098552978, 12.516055107470525, 18.983795982206736, 25.45153685694295, 32.30452741129211, 39.65647423809599, 47.118166530028965, 55.741258864607616, 59.491751332051145, 63.419078149693746, 67.98500815788157, 65.14282660891648, 62.01767679500509}
	rocArr := []float64{math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), math.NaN(), -0.5779496035795494, -0.014046457842657695, -2.5044142669106506, 2.229151290313148, -0.6399155088492744, 1.3456337198403985, -0.36632935349959006, -0.4730865926863215, -1.0023948679505659, -1.649510311906811, -2.6705087492322415, -1.5723322214502333, -5.273887862297524, -0.7344858434043171, -3.6748094225205183, -3.311071986444627, -2.6226428246603395, -2.1306323210121354, -1.9922730845779415, -1.5169010775066345, -2.075178813973259, -1.8893011231050774, -1.229099325591599, 0.02160212318010435, -0.12356116277556894, -0.8007226615762253, -0.5203750808806663, -0.7645077286953197, -0.46490860319504623, 1.666831789717508, 1.2046213656025846, -0.8669683379796101, 0.8412723987919186, 0.8241890048731673, 0.6604561339605745, 1.2451088695939434, 0.38829408547971966, -1.6721056614628076, -10.582680869652876, -11.939011524103233, -11.395986238142628, -11.013241318352565, -11.234606926415752, -11.090932056135697, -10.198337837148827, -10.360823329496247, -9.273047669462015, -2.2751102041736715, 0.17510108631793206}
	heiKenArr := []float64{30516.9, 30510.1125, 30522.08125, 30725.578125, 30840.8515625, 30707.36328125, 30572.281640625, 30326.865820312498, 30288.94541015625, 30257.272705078125, 30317.823852539062, 30417.861926269532, 30476.893463134766, 30725.14673156738, 30769.01086578369, 30530.742932891844, 30388.48396644592, 30232.079483222962, 30065.927241611484, 29991.051120805743, 29942.43806040287, 29901.781530201435, 29858.79076510072, 29922.07038255036, 29730.585191275182, 29464.367595637592, 29395.396297818796, 29343.898148909397, 29316.7240744547, 29317.67453722735, 29291.174768613677, 29285.31238430684, 29293.53119215342, 29376.453096076708, 29281.451548038356, 29188.850774019178, 29127.40038700959, 29102.587693504796, 29080.718846752396, 29333.3719233762, 29522.1109616881, 29517.317980844047, 29464.196490422022, 29440.373245211013, 29399.399122605508, 29383.387061302754, 29335.49353065138, 29150.97176532569, 28160.610882662844, 27214.030441331422, 26629.902720665712, 26377.176360332855, 26235.000680166428, 26063.500340083214, 26165.462670041605, 26206.118835020803, 26136.8969175104, 26087.748458755203}
	runIndCases(t, []CaseItem{
		{"sum", sumArr, func() float64 {
			return Sum(env.Close, 9).Get(0)
		}},
		{"sma", smaArr, func() float64 {
			return SMA(env.Close, 9).Get(0)
		}},
		{"vwma", vwmaArr, func() float64 {
			return VWMA(env, 9).Get(0)
		}},
		{"ema", emaArr, func() float64 {
			return EMA(env.Close, 12).Get(0)
		}},
		{"ema2", ema2Arr, func() float64 {
			return EMABy(env.Close, 12, 1).Get(0)
		}},
		{"rma", rmaArr, func() float64 {
			return RMA(env.Close, 12).Get(0)
		}},
		{"rma2", ram2Arr, func() float64 {
			return RMABy(env.Close, 12, 1, math.NaN()).Get(0)
		}},
		{"atr", atrArr, func() float64 {
			return ATR(env.High, env.Low, env.Close, 14).Get(0)
		}},
		{"macd", macdArr, func() float64 {
			return MACD(env.Close, 12, 26, 9).Cols[0].Get(0)
		}},
		{"rsi", rsiArr, func() float64 {
			return RSI(env.Close, 14).Get(0)
		}},
		{"kdj", kdjKArr, func() float64 {
			return KDJ(env.High, env.Low, env.Close, 9, 3, 3).Cols[0].Get(0)
		}},
		{"kdj_sma", smaKdjKArr, func() float64 {
			return KDJBy(env.High, env.Low, env.Close, 9, 3, 3, "sma").Cols[0].Get(0)
		}},
		{"stdDev", stdDevArr, func() float64 {
			return StdDev(env.Close, 5).Cols[0].Get(0)
		}},
		{"BBands", bbandArr, func() float64 {
			return BBANDS(env.Close, 7, 2, 2).Cols[0].Get(0)
		}},
		{"TD", tdArr, func() float64 {
			return TD(env.Close).Get(0)
		}},
		{"ADX", adxArr, func() float64 {
			return ADX(env.High, env.Low, env.Close, 9).Cols[0].Get(0)
		}},
		{"ROC", rocArr, func() float64 {
			return ROC(env.Close, 9).Get(0)
		}},
		{"HeikinAshi", heiKenArr, func() float64 {
			return HeikinAshi(env).Cols[0].Get(0)
		}},
	})
}
